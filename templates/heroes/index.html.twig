{% extends 'base.html.twig' %}

{% block title %}Heroes Gallery - OddOne Gaming{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('app') }}
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            overflow-x: hidden;
            background:
                linear-gradient(135deg, rgba(10, 14, 39, 0.92) 0%, rgba(26, 31, 58, 0.92) 100%),
                url('{{ asset('images/castle-background.jpg') }}') center/cover no-repeat fixed;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(0, 255, 100, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 200, 255, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .heroes-section { position: relative; min-height: 100vh; padding: 180px 0 80px 0; z-index: 1; }
        .container-custom { max-width: 1400px; margin: 0 auto; padding: 0 40px; position: relative; z-index: 2; }

        .page-header { text-align: center; margin-bottom: 50px; }

        .page-title {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .filters-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            padding: 35px;
            margin-bottom: 40px;
            transition: all 0.4s ease;
        }

        .filters-card:hover {
            border-color: rgba(0, 255, 136, 0.4);
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.2);
        }

        .filters-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            color: #00ff88;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .filter-group { margin-bottom: 0; }

        .filter-label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        /* Search input */
        .filter-input{
            width: 100%;
            padding: 0.875rem 1.25rem;
            font-size: 1rem;
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .filter-input:hover {
            border-color: rgba(0, 255, 136, 0.3);
            background-color: rgba(255, 255, 255, 0.08);
        }

        .filter-input:focus {
            outline: none;
            border-color: #00ff88;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.1),
                        0 8px 25px rgba(0, 255, 136, 0.15);
        }

        /* ---- Custom dropdown with images (instead of native select) ---- */
        .native-hidden{
            position:absolute !important;
            left:-9999px !important;
            width:1px !important;
            height:1px !important;
            opacity:0 !important;
            pointer-events:none !important;
        }

        .custom-select{ position: relative; }

        .custom-select-trigger{
            width:100%;
            display:flex;
            align-items:center;
            gap:10px;
            padding: 0.875rem 1.25rem;
            border:2px solid rgba(0,255,136,0.2);
            border-radius:12px;
            background: rgba(255,255,255,0.05);
            color:#fff;
            cursor:pointer;
            transition: all 0.3s ease;
        }

        .custom-select-trigger:hover{
            border-color: rgba(0, 255, 136, 0.3);
            background-color: rgba(255, 255, 255, 0.08);
        }

        .custom-select-trigger:focus{
            outline:none;
            border-color:#00ff88;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.1),
                        0 8px 25px rgba(0, 255, 136, 0.15);
        }

        .custom-select-img{
            width:22px;
            height:22px;
            object-fit:contain;
            flex: 0 0 auto;
            border-radius: 6px;
        }

        .custom-select-text{ flex:1; text-align:left; }
        .custom-select-caret{ opacity:0.8; }

        .custom-select-menu{
            display:none;
            position:absolute;
            top: calc(100% + 8px);
            left:0; right:0;
            background:#1a1f3a;
            border:1px solid rgba(0,255,136,0.25);
            border-radius:12px;
            overflow:hidden;
            z-index:50;
            max-height:260px;
            overflow-y:auto;
        }

        .custom-select.open .custom-select-menu{ display:block; }

        .custom-select-option{
            display:flex;
            align-items:center;
            gap:10px;
            padding:10px 12px;
            cursor:pointer;
            color:#fff;
        }

        .custom-select-option:hover{
            background: rgba(0,255,136,0.10);
        }

        .custom-select-option img{
            width:22px;
            height:22px;
            object-fit:contain;
            border-radius: 6px;
        }
        /* ---- end custom dropdown ---- */

        .filter-checkboxes-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-checkboxes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .accordion-filter {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .accordion-filter:hover { border-color: rgba(0, 255, 136, 0.3); }

        .accordion-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 255, 136, 0.05);
            transition: all 0.3s ease;
            user-select: none;
        }

        .accordion-header:hover { background: rgba(0, 255, 136, 0.1); }
        .accordion-header.active { background: rgba(0, 255, 136, 0.15); }

        .accordion-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: #00ff88;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .accordion-icon { color: #00ff88; transition: transform 0.3s ease; font-size: 1.2rem; }
        .accordion-header.active .accordion-icon { transform: rotate(180deg); }

        .accordion-body { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .accordion-body.active { max-height: 400px; overflow-y: auto; }

        .checkbox-list { padding: 15px; display: flex; flex-direction: column; gap: 10px; }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover { background: rgba(0, 255, 136, 0.05); }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #00ff88;
        }

        /* label + icon (AJOUT) */
        .checkbox-label{
            flex: 1;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-icon{
            width: 22px;
            height: 22px;
            object-fit: contain;
            border-radius: 6px;
            flex: 0 0 auto;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            padding: 2px;
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
        }

        .btn-reset {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-reset:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #00ff88;
            color: #00ff88;
            transform: translateY(-2px);
        }

        .btn-import {
            padding: 12px 30px;
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            color: #0a0e27;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .btn-import:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.5);
            color: #0a0e27;
        }

        .results-counter {
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            color: #0a0e27;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
            transition: all 0.3s ease;
        }

        .heroes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .hero-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .hero-card.hidden { display: none; }

        .hero-card:hover {
            transform: translateY(-10px);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.3);
        }

        /* rarity styles (inchang√©) */
        .hero-card[data-rarity-name="legendary"],
        .hero-card[data-rarity-name="Legendary"],
        .hero-card[data-rarity-name="L√©gendaire"],
        .hero-card[data-rarity-name="LEGENDARY"] {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(218, 165, 32, 0.15) 100%);
            border: 2px solid rgba(255, 215, 0, 0.6);
        }

        .hero-card[data-rarity-name="legendary"]:hover,
        .hero-card[data-rarity-name="Legendary"]:hover,
        .hero-card[data-rarity-name="L√©gendaire"]:hover,
        .hero-card[data-rarity-name="LEGENDARY"]:hover {
            border-color: rgba(255, 215, 0, 0.9);
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.5);
        }

        .hero-card[data-rarity-name="epic"],
        .hero-card[data-rarity-name="Epic"],
        .hero-card[data-rarity-name="√âpique"],
        .hero-card[data-rarity-name="EPIC"] {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15) 0%, rgba(148, 0, 211, 0.15) 100%);
            border: 2px solid rgba(138, 43, 226, 0.6);
        }

        .hero-card[data-rarity-name="epic"]:hover,
        .hero-card[data-rarity-name="Epic"]:hover,
        .hero-card[data-rarity-name="√âpique"]:hover,
        .hero-card[data-rarity-name="EPIC"]:hover {
            border-color: rgba(138, 43, 226, 0.9);
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.5);
        }

        .hero-card[data-rarity-name="rare"],
        .hero-card[data-rarity-name="Rare"],
        .hero-card[data-rarity-name="RARE"] {
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.15) 0%, rgba(65, 105, 225, 0.15) 100%);
            border: 2px solid rgba(30, 144, 255, 0.6);
        }

        .hero-card[data-rarity-name="rare"]:hover,
        .hero-card[data-rarity-name="Rare"]:hover,
        .hero-card[data-rarity-name="RARE"]:hover {
            border-color: rgba(30, 144, 255, 0.9);
            box-shadow: 0 20px 60px rgba(30, 144, 255, 0.5);
        }

        .hero-card[data-rarity-name="uncommon"],
        .hero-card[data-rarity-name="Uncommon"],
        .hero-card[data-rarity-name="Peu commun"],
        .hero-card[data-rarity-name="UNCOMMON"] {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(22, 163, 74, 0.15) 100%);
            border: 2px solid rgba(34, 197, 94, 0.6);
        }

        .hero-card[data-rarity-name="uncommon"]:hover,
        .hero-card[data-rarity-name="Uncommon"]:hover,
        .hero-card[data-rarity-name="Peu commun"]:hover,
        .hero-card[data-rarity-name="UNCOMMON"]:hover {
            border-color: rgba(34, 197, 94, 0.9);
            box-shadow: 0 20px 60px rgba(34, 197, 94, 0.5);
        }

        .hero-card[data-rarity-name="common"],
        .hero-card[data-rarity-name="Common"],
        .hero-card[data-rarity-name="Commun"],
        .hero-card[data-rarity-name="COMMON"] {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.15) 0%, rgba(107, 114, 128, 0.15) 100%);
            border: 2px solid rgba(156, 163, 175, 0.6);
        }

        .hero-card[data-rarity-name="common"]:hover,
        .hero-card[data-rarity-name="Common"]:hover,
        .hero-card[data-rarity-name="Commun"]:hover,
        .hero-card[data-rarity-name="COMMON"]:hover {
            border-color: rgba(156, 163, 175, 0.9);
            box-shadow: 0 20px 60px rgba(156, 163, 175, 0.5);
        }

        .hero-image { position: relative; height: 300px; overflow: hidden; background: rgba(255, 255, 255, 0.05); }
        .hero-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .hero-card:hover .hero-image img { transform: scale(1.1); }

        .hero-header { background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%); padding: 15px 20px; text-align: center; }

        .hero-name {
            color: #0a0e27;
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hero-footer { padding: 15px; background: rgba(255, 255, 255, 0.02); border-top: 1px solid rgba(255, 255, 255, 0.1); }

        .hero-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .hero-actions-full { grid-template-columns: 1fr; }

        .btn-action {
            padding: 12px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-view { background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%); color: #0a0e27; }
        .btn-view:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4); color: #0a0e27; }

        .btn-edit { background: rgba(255, 255, 255, 0.05); color: #ffffff; border: 2px solid rgba(255, 255, 255, 0.2); }
        .btn-edit:hover { background: rgba(255, 255, 255, 0.1); border-color: #00ff88; color: #00ff88; transform: translateY(-2px); }

        .empty-state {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 2px dashed rgba(0, 255, 136, 0.2);
            padding: 60px 40px;
            text-align: center;
            grid-column: 1 / -1;
            display: none;
        }

        .empty-state.show { display: block; }

        @media (max-width: 768px) {
            .container-custom { padding: 0 20px; }
            .page-title { font-size: 2.5rem; }
            .heroes-grid { grid-template-columns: 1fr; }
            .filters-grid, .filter-checkboxes-grid { grid-template-columns: 1fr; }
            .hero-actions { grid-template-columns: 1fr; }
            .filters-card { padding: 25px; }
            .filter-actions { flex-direction: column; }
            .btn-reset, .btn-import { width: 100%; text-align: center; }
        }
    </style>
{% endblock %}

{% block body %}
    <div class="heroes-section">
        <div class="container-custom">
            <div class="page-header">
                <h1 class="page-title">üéÆ Heroes Gallery</h1>
            </div>

            <div class="filters-card">
                <div class="filters-header">
                    <i class="fas fa-filter"></i>
                    <span>Search Filters</span>
                </div>

                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">üîé Search hero</label>
                        <input id="filter-name" class="filter-input" type="text" placeholder="Type a hero name (ex: drac)" autocomplete="off">
                    </div>

                    {% set filterDefs = [
                        { key: 'faction', label: '‚öîÔ∏è Realm', all: 'All realms', list: factions },
                        { key: 'type', label: 'üõ°Ô∏è Archetype', all: 'All archetypes', list: types },
                        { key: 'affinity', label: '‚ö° Affinity', all: 'All affinities', list: affinities },
                        { key: 'allegiance', label: 'üö© Allegiance', all: 'All allegiances', list: allegiances },
                        { key: 'rarity', label: '‚≠ê Rarity', all: 'All rarities', list: rarities },
                        { key: 'leader', label: 'üëë Leader Aura', all: 'Leader Auras', list: leaders },
                    ] %}

                    {% for def in filterDefs %}
                        <div class="filter-group">
                            <label class="filter-label">{{ def.label }}</label>

                            <select id="filter-{{ def.key }}" class="filter-select native-hidden">
                                <option value="">{{ def.all }}</option>
                                {% for item in def.list %}
                                    {% set icon = '' %}
                                    {% if item.iconUrl is defined and item.iconUrl %}
                                        {% set icon = item.iconUrl %}
                                    {% elseif item.imageUrl is defined and item.imageUrl %}
                                        {% set icon = item.imageUrl %}
                                    {% endif %}
                                    <option value="{{ item.id }}" data-img="{{ icon|e('html_attr') }}">{{ item.name }}</option>
                                {% endfor %}
                            </select>

                            <div class="custom-select" data-for="filter-{{ def.key }}">
                                <button type="button" class="custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                                    <img class="custom-select-img" alt="" style="display:none;" loading="lazy">
                                    <span class="custom-select-text">{{ def.all }}</span>
                                    <span class="custom-select-caret">‚ñæ</span>
                                </button>

                                <div class="custom-select-menu" role="listbox">
                                    <div class="custom-select-option" role="option" data-value="" data-img="">
                                        <span>{{ def.all }}</span>
                                    </div>

                                    {% for item in def.list %}
                                        {% set icon = '' %}
                                        {% if item.iconUrl is defined and item.iconUrl %}
                                            {% set icon = item.iconUrl %}
                                        {% elseif item.imageUrl is defined and item.imageUrl %}
                                            {% set icon = item.imageUrl %}
                                        {% endif %}

                                        <div class="custom-select-option" role="option"
                                             data-value="{{ item.id }}"
                                             data-img="{{ icon|e('html_attr') }}">
                                            {% if icon %}
                                                <img src="{{ icon }}" alt="" loading="lazy">
                                            {% endif %}
                                            <span>{{ item.name }}</span>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <div class="filter-checkboxes-section">
                    <div class="filter-checkboxes-grid">
                        {# ---------- BUFFS ---------- #}
                        <div class="accordion-filter">
                            <div class="accordion-header" data-accordion="buffs">
                                <div class="accordion-title"><i class="fas fa-arrow-up"></i> ‚ú® Buffs</div>
                                <i class="fas fa-chevron-down accordion-icon"></i>
                            </div>
                            <div class="accordion-body" id="accordion-buffs">
                                <div class="checkbox-list">
                                    {% for buff in buffs %}
                                        {% set icon = '' %}
                                        {% if buff.iconUrl is defined and buff.iconUrl %}
                                            {% set icon = buff.iconUrl %}
                                        {% elseif buff.imageUrl is defined and buff.imageUrl %}
                                            {% set icon = buff.imageUrl %}
                                        {% endif %}

                                        <div class="checkbox-item">
                                            <input type="checkbox" id="buff-{{ buff.id }}" class="filter-buff-checkbox" value="{{ buff.id }}">
                                            <label class="checkbox-label" for="buff-{{ buff.id }}">
                                                {% if icon %}
                                                    <img class="checkbox-icon" src="{{ icon }}" alt="" loading="lazy">
                                                {% endif %}
                                                <span>{{ buff.name }}</span>
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        {# ---------- DEBUFFS ---------- #}
                        <div class="accordion-filter">
                            <div class="accordion-header" data-accordion="debuffs">
                                <div class="accordion-title"><i class="fas fa-arrow-down"></i> üíÄ Debuffs</div>
                                <i class="fas fa-chevron-down accordion-icon"></i>
                            </div>
                            <div class="accordion-body" id="accordion-debuffs">
                                <div class="checkbox-list">
                                    {% for debuff in debuffs %}
                                        {% set icon = '' %}
                                        {% if debuff.iconUrl is defined and debuff.iconUrl %}
                                            {% set icon = debuff.iconUrl %}
                                        {% elseif debuff.imageUrl is defined and debuff.imageUrl %}
                                            {% set icon = debuff.imageUrl %}
                                        {% endif %}

                                        <div class="checkbox-item">
                                            <input type="checkbox" id="debuff-{{ debuff.id }}" class="filter-debuff-checkbox" value="{{ debuff.id }}">
                                            <label class="checkbox-label" for="debuff-{{ debuff.id }}">
                                                {% if icon %}
                                                    <img class="checkbox-icon" src="{{ icon }}" alt="" loading="lazy">
                                                {% endif %}
                                                <span>{{ debuff.name }}</span>
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        {# ---------- DISABLES ---------- #}
                        <div class="accordion-filter">
                            <div class="accordion-header" data-accordion="disables">
                                <div class="accordion-title"><i class="fas fa-ban"></i> üö´ Disables</div>
                                <i class="fas fa-chevron-down accordion-icon"></i>
                            </div>
                            <div class="accordion-body" id="accordion-disables">
                                <div class="checkbox-list">
                                    {% for disable in disables %}
                                        {% set icon = '' %}
                                        {% if disable.iconUrl is defined and disable.iconUrl %}
                                            {% set icon = disable.iconUrl %}
                                        {% elseif disable.imageUrl is defined and disable.imageUrl %}
                                            {% set icon = disable.imageUrl %}
                                        {% endif %}

                                        <div class="checkbox-item">
                                            <input type="checkbox" id="disable-{{ disable.id }}" class="filter-disable-checkbox" value="{{ disable.id }}">
                                            <label class="checkbox-label" for="disable-{{ disable.id }}">
                                                {% if icon %}
                                                    <img class="checkbox-icon" src="{{ icon }}" alt="" loading="lazy">
                                                {% endif %}
                                                <span>{{ disable.name }}</span>
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {# ---------- INSTANTS (BUFFS & DEBUFFS REGROUP√âS) ---------- #}
<div class="accordion-filter">
    <div class="accordion-header" data-accordion="instants">
        <div class="accordion-title">
            <i class="fas fa-bolt"></i> ‚ú® Instant Effects
        </div>
        <i class="fas fa-chevron-down accordion-icon"></i>
    </div>
    <div class="accordion-body" id="accordion-instants">
        <div class="checkbox-list">
            {% for instant in instants %}
                <div class="checkbox-item">
                    <input type="checkbox" 
                           id="instant-{{ instant.id }}" 
                           class="filter-instant-checkbox" 
                           value="{{ instant.id }}">
                    
                    <label class="checkbox-label" for="instant-{{ instant.id }}">
                        {% if instant.icon %}
                            <img class="checkbox-icon" 
                                 src="{{ asset('images/icons/instants/' ~ instant.icon) }}" 
                                 alt="{{ instant.label }}" 
                                 loading="lazy">
                        {% endif %}
                        <span>{{ instant.label }}</span>
                    </label>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
                    </div>
                </div>

                <div class="filter-actions">
                    <button type="button" id="btn-reset" class="btn-reset">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('app_heroes_new') }}" class="btn-import">
    <i class="fas fa-plus-circle"></i> Add hero
</a>
                    {% endif %}
                </div>
            </div>

            <div class="results-counter" id="results-counter">
                <i class="fas fa-chart-bar"></i> {{ heroes|length }} hero{{ heroes|length != 1 ? 'es' : '' }} found
            </div>

            <div class="heroes-grid" id="heroes-grid">
                {% for hero in heroes %}
                    {% set buffsList = [] %}
                    {% set debuffsList = [] %}
                    {% set disablesList = [] %}

                    {% for buff in hero.heroBuffs %}
                        {% set buffsList = buffsList|merge([buff.id]) %}
                    {% endfor %}
                    {% for debuff in hero.heroDebuffs %}
                        {% set debuffsList = debuffsList|merge([debuff.id]) %}
                    {% endfor %}
                    {% for disable in hero.heroDisables %}
                        {% set disablesList = disablesList|merge([disable.id]) %}
                    {% endfor %}

                    <div class="hero-card"
                         data-name="{{ hero.Name|lower }}"
                         data-faction="{{ hero.factionEntity ? hero.factionEntity.id : '' }}"
                         data-type="{{ hero.typeEntity ? hero.typeEntity.id : '' }}"
                         data-affinity="{{ hero.affinityEntity ? hero.affinityEntity.id : '' }}"
                         data-allegiance="{{ hero.allegianceEntity ? hero.allegianceEntity.id : '' }}"
                         data-rarity="{{ hero.rarityEntity ? hero.rarityEntity.id : '' }}"
                         data-rarity-name="{{ hero.rarityEntity ? hero.rarityEntity.name|lower : '' }}"
                         data-leader="{{ hero.leaderEntity ? hero.leaderEntity.id : '' }}"
                         data-buffs="{{ buffsList|join(',') }}"
                         data-debuffs="{{ debuffsList|join(',') }}"
                         data-disable="{{ disablesList|join(',') }}">

                        <div class="hero-image">
                            {% if hero.imageUrl %}
                                <img src="{{ hero.imageUrl }}" alt="{{ hero.Name }}" loading="lazy">
                            {% else %}
                                <img src="https://via.placeholder.com/400x400/667eea/ffffff?text={{ hero.Name|url_encode }}" alt="{{ hero.Name }}">
                            {% endif %}
                        </div>

                        <div class="hero-header">
                            <h3 class="hero-name">{{ hero.Name }}</h3>
                        </div>

                        <div class="hero-footer">
                           <div class="hero-actions {% if not is_granted('ROLE_ADMIN') %}hero-actions-full{% endif %}">
    <a href="{{ path('app_heroes_show', {'slug': hero.slug}) }}" class="btn-action btn-view">
        <i class="fas fa-eye"></i> View
    </a>

    {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('app_heroes_edit', {'slug': hero.slug}) }}" class="btn-action btn-edit">
            <i class="fas fa-edit"></i> Edit
        </a>
    {% endif %}
</div>

                        </div>
                    </div>
                {% endfor %}

                <div class="empty-state" id="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3 class="empty-title">No Heroes Found</h3>
                    <p class="empty-text">No hero matches your search criteria.</p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('app') }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Accordions
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', function() {
                    const targetId = this.dataset.accordion;
                    const body = document.getElementById('accordion-' + targetId);
                    this.classList.toggle('active');
                    body.classList.toggle('active');
                });
            });

            // Custom selects (images + sync with native selects)
            function closeAllCustomSelects(except = null){
                document.querySelectorAll('.custom-select.open').forEach(cs => {
                    if (except && cs === except) return;
                    cs.classList.remove('open');
                    cs.querySelector('.custom-select-trigger')?.setAttribute('aria-expanded', 'false');
                });
            }

            document.addEventListener('click', () => closeAllCustomSelects());

            document.querySelectorAll('.custom-select').forEach(cs => {
                const selectId = cs.dataset.for;
                const native = document.getElementById(selectId);
                const trigger = cs.querySelector('.custom-select-trigger');
                const textEl = cs.querySelector('.custom-select-text');
                const imgEl = cs.querySelector('.custom-select-img');

                if (!native || !trigger || !textEl || !imgEl) return;

                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = cs.classList.toggle('open');
                    trigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
                    closeAllCustomSelects(cs);
                });

                cs.querySelectorAll('.custom-select-option').forEach(opt => {
                    opt.addEventListener('click', (e) => {
                        e.stopPropagation();

                        const value = opt.dataset.value ?? '';
                        const img = opt.dataset.img ?? '';
                        const label = opt.textContent.trim();

                        native.value = value;
                        native.dispatchEvent(new Event('change', { bubbles: true }));

                        textEl.textContent = label;
                        if (img) { imgEl.src = img; imgEl.style.display = 'block'; }
                        else { imgEl.removeAttribute('src'); imgEl.style.display = 'none'; }

                        cs.classList.remove('open');
                        trigger.setAttribute('aria-expanded', 'false');
                    });
                });
            });

            // ---- Filtering logic ----
            const selectFilters = {
                faction: document.getElementById('filter-faction'),
                type: document.getElementById('filter-type'),
                affinity: document.getElementById('filter-affinity'),
                allegiance: document.getElementById('filter-allegiance'),
                rarity: document.getElementById('filter-rarity'),
                leader: document.getElementById('filter-leader')
            };

            const nameInput = document.getElementById('filter-name');

            const buffCheckboxes = document.querySelectorAll('.filter-buff-checkbox');
            const debuffCheckboxes = document.querySelectorAll('.filter-debuff-checkbox');
            const disableCheckboxes = document.querySelectorAll('.filter-disable-checkbox');

            const heroCards = document.querySelectorAll('.hero-card');
            const resultsCounter = document.getElementById('results-counter');
            const emptyState = document.getElementById('empty-state');
            const btnReset = document.getElementById('btn-reset');

            function filterHeroes() {
                const selectedFilters = {
                    name: (nameInput?.value || '').trim().toLowerCase(),
                    faction: selectFilters.faction.value,
                    type: selectFilters.type.value,
                    affinity: selectFilters.affinity.value,
                    allegiance: selectFilters.allegiance.value,
                    rarity: selectFilters.rarity.value,
                    leader: selectFilters.leader.value,
                    buffs: Array.from(buffCheckboxes).filter(cb => cb.checked).map(cb => cb.value),
                    debuffs: Array.from(debuffCheckboxes).filter(cb => cb.checked).map(cb => cb.value),
                    disables: Array.from(disableCheckboxes).filter(cb => cb.checked).map(cb => cb.value)
                };

                let visibleCount = 0;

                heroCards.forEach(card => {
                    let shouldShow = true;

                    if (selectedFilters.name) {
                        const heroName = (card.dataset.name || '');
                        if (!heroName.includes(selectedFilters.name)) shouldShow = false;
                    }

                    if (shouldShow && selectedFilters.faction && card.dataset.faction !== selectedFilters.faction) shouldShow = false;
                    if (shouldShow && selectedFilters.type && card.dataset.type !== selectedFilters.type) shouldShow = false;
                    if (shouldShow && selectedFilters.affinity && card.dataset.affinity !== selectedFilters.affinity) shouldShow = false;
                    if (shouldShow && selectedFilters.allegiance && card.dataset.allegiance !== selectedFilters.allegiance) shouldShow = false;
                    if (shouldShow && selectedFilters.rarity && card.dataset.rarity !== selectedFilters.rarity) shouldShow = false;
                    if (shouldShow && selectedFilters.leader && card.dataset.leader !== selectedFilters.leader) shouldShow = false;

                    if (shouldShow && selectedFilters.buffs.length > 0) {
                        const cardBuffs = (card.dataset.buffs || '').split(',').filter(Boolean);
                        const hasAllBuffs = selectedFilters.buffs.every(buff => cardBuffs.includes(buff));
                        if (!hasAllBuffs) shouldShow = false;
                    }

                    if (shouldShow && selectedFilters.debuffs.length > 0) {
                        const cardDebuffs = (card.dataset.debuffs || '').split(',').filter(Boolean);
                        const hasAllDebuffs = selectedFilters.debuffs.every(debuff => cardDebuffs.includes(debuff));
                        if (!hasAllDebuffs) shouldShow = false;
                    }

                    if (shouldShow && selectedFilters.disables.length > 0) {
                        const cardDisables = (card.dataset.disable || '').split(',').filter(Boolean);
                        const hasAllDisables = selectedFilters.disables.every(disable => cardDisables.includes(disable));
                        if (!hasAllDisables) shouldShow = false;
                    }

                    if (shouldShow) {
                        card.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        card.classList.add('hidden');
                    }
                });

                resultsCounter.innerHTML = `<i class="fas fa-chart-bar"></i> ${visibleCount} hero${visibleCount !== 1 ? 'es' : ''} found`;
                if (visibleCount === 0) emptyState.classList.add('show');
                else emptyState.classList.remove('show');
            }

            Object.values(selectFilters).forEach(filter => {
                filter.addEventListener('change', filterHeroes);
            });

            if (nameInput) nameInput.addEventListener('input', filterHeroes);

            buffCheckboxes.forEach(cb => cb.addEventListener('change', filterHeroes));
            debuffCheckboxes.forEach(cb => cb.addEventListener('change', filterHeroes));
            disableCheckboxes.forEach(cb => cb.addEventListener('change', filterHeroes));

            btnReset.addEventListener('click', function() {
                Object.values(selectFilters).forEach(filter => { filter.value = ''; });
                if (nameInput) nameInput.value = '';

                buffCheckboxes.forEach(cb => cb.checked = false);
                debuffCheckboxes.forEach(cb => cb.checked = false);
                disableCheckboxes.forEach(cb => cb.checked = false);

                document.querySelectorAll('.accordion-header').forEach(header => header.classList.remove('active'));
                document.querySelectorAll('.accordion-body').forEach(body => body.classList.remove('active'));

                // reset custom dropdown UI
                document.querySelectorAll('.custom-select').forEach(cs => {
                    const native = document.getElementById(cs.dataset.for);
                    const textEl = cs.querySelector('.custom-select-text');
                    const imgEl = cs.querySelector('.custom-select-img');
                    const firstOptionLabel = cs.querySelector('.custom-select-option')?.textContent?.trim() || '';

                    if (native) native.value = '';
                    if (textEl) textEl.textContent = firstOptionLabel;
                    if (imgEl) { imgEl.removeAttribute('src'); imgEl.style.display = 'none'; }

                    cs.classList.remove('open');
                    cs.querySelector('.custom-select-trigger')?.setAttribute('aria-expanded','false');
                });

                heroCards.forEach(card => card.classList.remove('hidden'));
                resultsCounter.innerHTML = `<i class="fas fa-chart-bar"></i> ${heroCards.length} hero${heroCards.length !== 1 ? 'es' : ''} found`;
                emptyState.classList.remove('show');

                filterHeroes();
            });

            filterHeroes();
        });
    </script>
{% endblock %}
